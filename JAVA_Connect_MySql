package date0203;


import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Map;
import java.util.Scanner;
import java.util.TreeMap;
//不能util.*
public class P51_2 {
	public static void main(String[] args) throws SQLException {
		// TODO Auto-generated method stub
		Connection conn = null;
		Statement stmt = null;

		String sDriver = "com.mysql.cj.jdbc.Driver";

		System.out.print("輸入帳號 : ");
		Scanner scn = new Scanner(System.in);
		String user = scn.next();
		System.out.print("輸入密碼 : ");
		String pwd = scn.next();
		
		try {
			Class.forName(sDriver);
		} catch (ClassNotFoundException e) {
			System.out.println("Driver is not OK.");
			System.exit(0);
		}

		try {
			conn = DriverManager.getConnection("jdbc:mysql://localhost:8888/tset?" + "serverTimezone=GMT&useSSL=false&"//要以建立的資料庫test1
					+ "user=" + user + "&password=" + pwd);
			if (conn != null)
				System.out.println("建立Connection物件成功!");
			stmt = conn.createStatement();
			if (stmt != null)
				System.out.println("建立Statement物件成功!");
		} catch (SQLException e) {
			System.out.println("連線不成功");
			System.out.println(e.getMessage());
			if (conn != null) {
				try {
					conn.close();
				} catch (SQLException e2) {
				}
			}
			System.exit(0);
		}

		var fruit = new TreeMap<String, Integer>();
		int i = 0;
		while (i < 3) {
			System.out.print("請輸入furitname: ");
			var k = scn.next();
			System.out.print("請輸入price: ");
			var k1 = scn.nextInt();
			if (k.equals("q") || k1 == 0) {
				System.out.println("離開");
				break;
			} else {
				fruit.put(k, k1);
			}
			i++;
		}

		String sql = null;

		stmt.execute("create table fruit(no int, fruitname char(12) ,price int)");
		int j = 0;
		for (Map.Entry m : fruit.entrySet()) {
			sql = "insert into fruit(no, fruitname, price) values("+ (j+1) + ",\"" + m.getKey() + "\"" + ",\"" + m.getValue()
					+ "\");";
			try {
				stmt.executeUpdate(sql);
				System.out.println("成功寫入");
				j++;
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				System.out.println("寫入錯誤");
			}
		}
	}
}
